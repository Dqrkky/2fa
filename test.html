<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Fingerprint 2FA Authentication (Demo Mode)</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
                background-color: #f0f0f0;
            }
            button {
                padding: 10px 20px;
                font-size: 16px;
                margin: 10px;
            }
            #message {
                margin-top: 20px;
                font-size: 18px;
            }
        </style>
    </head>
    <body>
        <h2>Fingerprint 2FA Authentication (Demo Mode)</h2>
        <button id="register-btn">Register Fingerprint</button>
        <button id="login-btn">Login with Fingerprint</button>
        <p id="message"></p>
    
        <script>
            function bufferDecode(value) {
                return Uint8Array.from(atob(value.replace(/_/g, '/').replace(/-/g, '+')), c => c.charCodeAt(0));
            }
    
            function bufferEncode(value) {
                return btoa(String.fromCharCode(...new Uint8Array(value)))
                    .replace(/\+/g, '-')
                    .replace(/\//g, '_')
                    .replace(/=/g, '');
            }
    
            // Example challenge and user data for registration (hardcoded for demo)
            const exampleChallenge = "c29tZS1yYW5kb20tY2hhbGxlbmdl"; // "some-random-challenge" (Base64 encoded)
            const exampleUserId = "dXNlcklk"; // "userId" (Base64 encoded)
            const exampleUserEmail = "user@example.com";
            
            let exampleCredentialId = "Y3JlZGVudGlhbElk"; // "credentialId" (Base64 encoded)
    
            // Simulate registration
            document.getElementById('register-btn').addEventListener('click', async () => {
                try {
                    // Hardcoded public key creation options
                    const publicKeyCredentialCreationOptions = {
                        challenge: bufferDecode(exampleChallenge),
                        rp: { name: "DemoRP" },
                        user: {
                            id: bufferDecode(exampleUserId),
                            name: exampleUserEmail,
                            displayName: exampleUserEmail
                        },
                        pubKeyCredParams: [{ alg: -7, type: "public-key" }],
                        authenticatorSelection: { userVerification: "preferred" }
                    };
    
                    // Simulate fingerprint registration (WebAuthn credential creation)
                    const credential = await navigator.credentials.create({ publicKey: publicKeyCredentialCreationOptions });
    
                    // Format registration response
                    const registrationResponse = {
                        id: credential.id,
                        rawId: bufferEncode(credential.rawId),
                        type: credential.type,
                        response: {
                            attestationObject: bufferEncode(credential.response.attestationObject),
                            clientDataJSON: bufferEncode(credential.response.clientDataJSON)
                        }
                    };
                    exampleCredentialId = registrationResponse.id;
                    // Simulate successful registration
                    document.getElementById('message').innerText = `Registration successful! Credential ID: ${registrationResponse.id}`;
                } catch (error) {
                    document.getElementById('message').innerText = 'Error during registration: ' + error;
                }
            });
    
            // Example credential ID for authentication (hardcoded for demo)
    
            // Simulate authentication
            document.getElementById('login-btn').addEventListener('click', async () => {
                try {
                    // Hardcoded public key request options
                    const publicKeyCredentialRequestOptions = {
                        challenge: bufferDecode(exampleChallenge),
                        allowCredentials: [{
                            id: bufferDecode(exampleCredentialId),
                            type: 'public-key'
                        }],
                        userVerification: 'preferred'
                    };
    
                    // Simulate fingerprint authentication (WebAuthn credential request)
                    const credential = await navigator.credentials.get({ publicKey: publicKeyCredentialRequestOptions });
    
                    // Format authentication response
                    const authResponse = {
                        id: credential.id,
                        rawId: bufferEncode(credential.rawId),
                        type: credential.type,
                        response: {
                            clientDataJSON: bufferEncode(credential.response.clientDataJSON),
                            authenticatorData: bufferEncode(credential.response.authenticatorData),
                            signature: bufferEncode(credential.response.signature),
                            userHandle: credential.response.userHandle ? bufferEncode(credential.response.userHandle) : null
                        }
                    };
                    
                    // Simulate successful authentication
                    document.getElementById('message').innerText = `Authentication successful! Credential ID: ${authResponse.id}`;
                } catch (error) {
                    document.getElementById('message').innerText = 'Error during authentication: ' + error;
                }
            });
        </script>
    </body>
</html>